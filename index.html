<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>RBM Japan Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');
        
        :root { --primary: #059669; --dark: #022c22; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f0fdf4; -webkit-tap-highlight-color: transparent; }
        .font-display { font-family: 'Outfit', sans-serif; }

        /* MESH GRADIENT BACKGROUND (Premium Feel) */
        .mesh-bg {
            background-color: #ecfdf5;
            background-image: 
                radial-gradient(at 0% 0%, hsla(147,100%,77%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(126,100%,86%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(158,100%,76%,1) 0, transparent 50%);
        }

        /* CARD STYLES */
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 40px -10px rgba(0, 50, 30, 0.1);
        }

        /* PREMIUM VIRTUAL CARD (Kartu SPP) */
        .virtual-card {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(5, 150, 105, 0.4), 0 10px 10px -5px rgba(5, 150, 105, 0.2);
        }
        .virtual-card::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            transform: rotate(30deg); pointer-events: none;
        }

        /* Animations */
        .fade-in { animation: fadeIn 0.8s cubic-bezier(0.2, 0.8, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .ticker-text { animation: marquee 25s linear infinite; display: inline-block; white-space: nowrap; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        /* Toast & Modal */
        #toast { visibility: hidden; opacity: 0; transition: all 0.3s; transform: translateY(20px); }
        #toast.show { visibility: visible; opacity: 1; transform: translateY(0); }
        
        .modal-backdrop { opacity: 0; pointer-events: none; transition: all 0.3s; }
        .modal-backdrop.active { opacity: 1; pointer-events: auto; }
        .modal-content { transform: scale(0.95); opacity: 0; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .modal-backdrop.active .modal-content { transform: scale(1); opacity: 1; }
    </style>
</head>
<body class="min-h-screen mesh-bg text-slate-800 selection:bg-emerald-200">

    <div id="loader" class="fixed inset-0 z-50 bg-white flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="relative">
            <div class="w-16 h-16 border-4 border-emerald-100 rounded-full"></div>
            <div class="w-16 h-16 border-4 border-emerald-600 rounded-full border-t-transparent animate-spin absolute top-0 left-0"></div>
        </div>
        <p class="mt-4 text-xs font-bold text-emerald-800 tracking-widest uppercase animate-pulse">Memuat Portal</p>
    </div>

    <div id="app" class="relative z-10 hidden max-w-md mx-auto min-h-screen shadow-2xl bg-white/50"></div>

    <div class="fixed bottom-8 left-0 right-0 z-[60] flex justify-center pointer-events-none">
        <div id="toast" class="bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 text-xs font-bold shadow-slate-500/30">
            <i data-lucide="check-circle" class="text-emerald-400" width="16"></i>
            <span id="toast-msg">Berhasil!</span>
        </div>
    </div>

    <div id="modal-transfer" class="modal-backdrop fixed inset-0 z-[70] flex items-center justify-center px-6">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" onclick="toggleModal(false)"></div>
        <div class="modal-content bg-white w-full max-w-sm rounded-[2rem] p-6 shadow-2xl relative z-10">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-display font-bold text-lg text-slate-800">Info Transfer</h3>
                <button onclick="toggleModal(false)" class="bg-slate-100 p-2 rounded-full hover:bg-slate-200 transition"><i data-lucide="x" width="16"></i></button>
            </div>
            
            <div class="bg-slate-50 border border-slate-200 rounded-2xl p-5 mb-4 text-center">
                <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-2">Japan Post Bank (Yucho)</p>
                <div class="flex items-center justify-center gap-2 mb-1">
                    <h2 class="text-2xl font-black text-slate-800 tracking-tighter" id="rek-number">10120-12345678</h2>
                    <button onclick="copyText('10120-12345678', 'Nomor Rekening')" class="text-emerald-600 hover:bg-emerald-50 p-1.5 rounded-lg transition"><i data-lucide="copy" width="16"></i></button>
                </div>
                <p class="text-xs font-bold text-slate-500">a.n RBM JAPAN ADMIN</p>
            </div>

            <div class="text-[10px] text-slate-400 text-center leading-relaxed">
                Pastikan nama penerima sesuai. Simpan bukti transfer untuk konfirmasi.
            </div>
        </div>
    </div>

    <script>
        // --- SETTINGS ---
        const API_URL = "https://script.google.com/macros/s/AKfycbz2a5-sm2_gLBPF5jpTmZfBuN9PppkvUI3nXIyOJbYJ4XDZA3SDE7-FNU784ZxfSZjr/exec"; 
        const WEBSITE_URL = "https://rbj-site.vercel.app/";
        const ADMIN_WA = "6285819809668";
        
        // --- DATA ---
        let DATA_SISWA = [], DATA_HARGA = {}, KABAR_RBM = [], INFO_PENGUMUMAN = {};
        let STATE = { view: 'login', user: null, lang: 'id' };
        
        const DAY_NAMES = {
            id: { 'Senin': 'Senin', 'Selasa': 'Selasa', 'Rabu': 'Rabu', 'Kamis': 'Kamis', 'Jumat': 'Jumat', 'Sabtu': 'Sabtu', 'Ahad': 'Ahad' },
            en: { 'Senin': 'Monday', 'Selasa': 'Tuesday', 'Rabu': 'Wednesday', 'Kamis': 'Thursday', 'Jumat': 'Friday', 'Sabtu': 'Saturday', 'Ahad': 'Sunday' }
        };

        const TEKS = {
            id: { btn: "MASUK PORTAL", report: "IZIN", notes: "Catatan Guru", schedule: "Jadwal", history: "Riwayat", greet: ["Pagi", "Siang", "Sore", "Malam"], spp_label: "Total SPP (Bulan Ini)", pay_status: "Status Pembayaran" },
            en: { btn: "LOGIN", report: "ABSENCE", notes: "Teacher Notes", schedule: "Schedule", history: "History", greet: ["Morning", "Afternoon", "Evening", "Night"], spp_label: "Total Fee (This Month)", pay_status: "Payment Status" }
        };

        // --- CORE FUNCTIONS ---
        async function ambilData() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                DATA_SISWA = data.students; DATA_HARGA = data.prices; KABAR_RBM = data.news; INFO_PENGUMUMAN = data.info;
                finishLoad();
            } catch (e) { alert("Gagal memuat data. Periksa koneksi internet."); finishLoad(); }
        }

        function finishLoad() {
            document.getElementById('loader').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('app').classList.remove('hidden');
                renderApp();
            }, 500);
        }

        function toggleModal(show) {
            const m = document.getElementById('modal-transfer');
            if(show) m.classList.add('active'); else m.classList.remove('active');
        }

        function copyText(text, label) {
            navigator.clipboard.writeText(text).then(() => {
                document.getElementById('toast-msg').innerText = `${label} Disalin!`;
                document.getElementById('toast').classList.add('show');
                setTimeout(() => document.getElementById('toast').classList.remove('show'), 3000);
            });
        }

        function salinRincian(nama, total, status) {
            const txt = `INVOICE SPP RBM JAPAN\n------------------\nNama: ${nama}\nNominal: JPY Â¥${parseInt(total).toLocaleString('ja-JP')}\nStatus: ${status}\n\nMohon konfirmasi setelah transfer.`;
            copyText(txt, "Rincian SPP");
        }

        function getGreet() {
            const h = new Date().getHours();
            const g = TEKS[STATE.lang].greet;
            if (h < 11) return g[0]; if (h < 15) return g[1]; if (h < 19) return g[2]; return g[3];
        }

        function renderApp() {
            const app = document.getElementById('app');
            const t = TEKS[STATE.lang];

            if (STATE.view === 'login') {
                let opsi = `<option value="" disabled selected>Pilih Nama Siswa...</option>` + DATA_SISWA.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
                
                app.innerHTML = `
                <div class="min-h-screen flex flex-col items-center justify-center p-8 fade-in relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-emerald-500/10 to-transparent pointer-events-none"></div>

                    <button onclick="STATE.lang=STATE.lang==='id'?'en':'id';renderApp()" class="absolute top-6 right-6 text-[10px] font-bold bg-white border border-gray-200 px-3 py-1 rounded-full uppercase shadow-sm z-20">${STATE.lang}</button>

                    <div class="w-full max-w-sm relative z-10">
                        <div class="text-center mb-10">
                            <div class="inline-flex items-center justify-center w-20 h-20 bg-white rounded-3xl shadow-lg shadow-emerald-100 mb-6 transform rotate-3 hover:rotate-0 transition duration-500">
                                <img src="logo.png" class="h-10" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2991/2991148.png'">
                            </div>
                            <h1 class="font-display font-black text-3xl text-slate-800 tracking-tight mb-2">RBM PORTAL</h1>
                            <p class="text-slate-400 text-xs font-medium">Platform Belajar Mengaji & Bahasa Jepang</p>
                        </div>

                        <div class="glass-card p-8 rounded-[2rem]">
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 pl-1">Identitas Siswa</label>
                            <div class="relative mb-4">
                                <select id="selSiswa" class="w-full p-4 pl-5 bg-slate-50 border border-slate-200 rounded-2xl text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-emerald-500 appearance-none transition shadow-inner">${opsi}</select>
                                <div class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"><i data-lucide="chevron-down" width="16"></i></div>
                            </div>
                            <button onclick="const id=document.getElementById('selSiswa').value; if(id){STATE.user=DATA_SISWA.find(s=>s.id===id);STATE.view='dashboard';renderApp()}" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-4 rounded-2xl font-display font-bold text-sm tracking-wide shadow-lg shadow-emerald-200 transition active:scale-[0.98]">${t.btn}</button>
                            
                            <div class="mt-6 pt-6 border-t border-dashed border-slate-200 text-center">
                                <a href="${WEBSITE_URL}" target="_blank" class="text-[10px] font-bold text-emerald-600 hover:underline flex items-center justify-center gap-1">
                                    <i data-lucide="globe" width="10"></i> Kunjungi Website Resmi
                                </a>
                            </div>
                        </div>
                    </div>
                </div>`;
            } else {
                const s = STATE.user;
                let total = 0; s.classes.forEach(c => { total += (DATA_HARGA[c.split('(')[0].trim()] || 0); });
                if (s.role == 2) total *= 0.5;

                app.innerHTML = `
                <div class="pb-24 fade-in">
                    <div class="pt-12 px-8 pb-6 flex justify-between items-end">
                        <div>
                            <p class="text-slate-400 text-[10px] font-bold uppercase tracking-wider mb-1">Selamat ${getGreet()},</p>
                            <h2 class="font-display font-black text-2xl text-slate-800 leading-none">${s.name.split(' ')[0]}</h2>
                        </div>
                        <button onclick="location.reload()" class="bg-white p-2.5 rounded-2xl shadow-sm border border-slate-100 text-slate-400 hover:text-red-500 transition"><i data-lucide="log-out" width="18"></i></button>
                    </div>

                    <div class="px-6 space-y-6">
                        
                        <div class="virtual-card rounded-[2.5rem] p-8 relative group transform transition hover:scale-[1.01]">
                            <div class="flex justify-between items-start mb-8 relative z-10">
                                <div>
                                    <p class="text-[10px] font-medium opacity-80 uppercase tracking-widest mb-1">${t.spp_label}</p>
                                    <h1 class="font-display font-black text-4xl tracking-tight">JPY Â¥${total.toLocaleString('ja-JP')}</h1>
                                </div>
                                <div class="w-10 h-6 rounded-md bg-yellow-200/20 border border-yellow-200/40 flex items-center justify-center">
                                    <div class="w-6 h-4 border border-white/30 rounded-sm"></div>
                                </div>
                            </div>
                            
                            <div class="flex justify-between items-end relative z-10">
                                <div>
                                    <p class="text-[9px] opacity-60 uppercase mb-1">${t.pay_status}</p>
                                    <span class="inline-block bg-white/20 backdrop-blur-md px-3 py-1 rounded-lg text-[10px] font-bold border border-white/10 flex items-center gap-1">
                                        <div class="w-1.5 h-1.5 rounded-full ${s.payments['Bulan Ini']==='Lunas'?'bg-emerald-300':'bg-amber-300'} animate-pulse"></div> ${s.payments["Bulan Ini"]}
                                    </span>
                                </div>
                                <button onclick="laporIzin('${s.name}', '${s.id}')" class="bg-white text-emerald-700 px-4 py-2 rounded-xl text-[10px] font-bold shadow-lg hover:bg-emerald-50 transition flex items-center gap-1">
                                    <i data-lucide="send" width="12"></i> ${t.report}
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-3">
                            <button onclick="window.open('https://wa.me/${ADMIN_WA}?text=Konfirmasi SPP ${s.name} Total: Â¥${total}')" class="bg-white p-4 rounded-3xl border border-slate-100 shadow-sm flex flex-col items-center gap-2 hover:bg-emerald-50 transition group">
                                <div class="w-10 h-10 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center group-hover:scale-110 transition"><i data-lucide="message-circle" width="18"></i></div>
                                <span class="text-[10px] font-bold text-slate-600 text-center">Konfirmasi<br>WhatsApp</span>
                            </button>
                            
                            <button onclick="toggleModal(true)" class="bg-white p-4 rounded-3xl border border-slate-100 shadow-sm flex flex-col items-center gap-2 hover:bg-blue-50 transition group">
                                <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center group-hover:scale-110 transition"><i data-lucide="credit-card" width="18"></i></div>
                                <span class="text-[10px] font-bold text-slate-600 text-center">Info<br>Transfer</span>
                            </button>

                            <button onclick="salinRincian('${s.name}', '${total}', '${s.payments["Bulan Ini"]}')" class="bg-white p-4 rounded-3xl border border-slate-100 shadow-sm flex flex-col items-center gap-2 hover:bg-slate-50 transition group">
                                <div class="w-10 h-10 bg-slate-100 text-slate-600 rounded-full flex items-center justify-center group-hover:scale-110 transition"><i data-lucide="copy" width="18"></i></div>
                                <span class="text-[10px] font-bold text-slate-600 text-center">Salin<br>Rincian</span>
                            </button>
                        </div>

                        ${INFO_PENGUMUMAN.aktif ? `
                        <div class="bg-orange-50 border border-orange-100 rounded-2xl p-1 overflow-hidden">
                            <div class="bg-orange-100/50 rounded-xl px-3 py-2">
                                <div class="ticker-text text-[10px] font-bold text-orange-800 italic">ðŸ“¢ ${STATE.lang==='id'?INFO_PENGUMUMAN.teks_id:INFO_PENGUMUMAN.teks_en}</div>
                            </div>
                        </div>` : ''}

                        <div class="space-y-6 pb-4">
                            <section>
                                <div class="flex items-center justify-between mb-3 px-1">
                                    <h3 class="font-display font-bold text-slate-800 text-sm">Kabar Terbaru</h3>
                                </div>
                                <div class="flex gap-4 overflow-x-auto pb-4 px-1 snap-x hide-scroll">
                                    ${KABAR_RBM.map(k => `
                                    <div class="min-w-[240px] bg-white rounded-3xl border border-slate-100 overflow-hidden shadow-sm snap-center">
                                        <div class="h-28 bg-slate-200 relative"><img src="${k.foto}" class="w-full h-full object-cover"></div>
                                        <div class="p-4">
                                            <span class="text-[9px] font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded uppercase">${k.tgl}</span>
                                            <h4 class="text-xs font-bold text-slate-800 mt-2 line-clamp-2">${k.judul}</h4>
                                        </div>
                                    </div>`).join('') || '<div class="w-full p-6 text-center text-xs text-slate-400 italic bg-white rounded-2xl border border-dashed">Belum ada kabar</div>'}
                                </div>
                            </section>

                            <div class="grid gap-4">
                                <section>
                                    <h3 class="font-display font-bold text-slate-800 text-sm mb-3 px-1">${t.schedule}</h3>
                                    <div class="space-y-2">
                                        ${s.schedule.map(sc => `
                                        <div class="bg-white p-3 rounded-2xl border border-slate-100 flex items-center gap-3 shadow-[0_2px_10px_-4px_rgba(0,0,0,0.05)]">
                                            <div class="bg-slate-50 w-12 h-12 rounded-xl flex flex-col items-center justify-center text-[9px] font-black text-slate-500 uppercase leading-none border border-slate-200">
                                                ${(DAY_NAMES[STATE.lang][sc.day] || sc.day).substring(0,3)}
                                            </div>
                                            <div>
                                                <p class="text-xs font-bold text-slate-800">${sc.subject}</p>
                                                <p class="text-[10px] text-emerald-600 font-bold flex items-center gap-1"><i data-lucide="clock" width="8"></i> ${sc.time} JST</p>
                                            </div>
                                        </div>`).join('') || '<p class="text-xs text-slate-400 italic text-center py-4">Tidak ada jadwal</p>'}
                                    </div>
                                </section>

                                <section>
                                    <h3 class="font-display font-bold text-slate-800 text-sm mb-3 px-1">${t.notes}</h3>
                                    <div class="space-y-2">
                                        ${s.notes.map(n => `
                                        <div class="bg-blue-50/50 p-4 rounded-2xl border border-blue-100">
                                            <div class="flex justify-between items-center mb-1">
                                                <span class="text-[9px] font-bold text-blue-500 uppercase">${n.date}</span>
                                                <i data-lucide="message-square" class="text-blue-200" width="12"></i>
                                            </div>
                                            <p class="text-xs text-slate-600 font-medium">"${n.message}"</p>
                                        </div>`).join('') || '<p class="text-xs text-slate-400 italic text-center py-4">Tidak ada catatan</p>'}
                                    </div>
                                </section>
                            </div>

                        </div>
                    </div>
                </div>`;
            }
            lucide.createIcons();
        }

        function login() { const id = document.getElementById('selSiswa').value; if(!id) return; STATE.user = DATA_SISWA.find(s => s.id === id); STATE.view = 'dashboard'; renderApp(); }
        function laporIzin(nama, id) { window.open(`https://wa.me/${ADMIN_WA}?text=Assalamu'alaikum, izin untuk murid ${nama} (${id}) hari ini dikarenakan...`); }
        ambilData();
    </script>
</body>
</html>
